<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Detective Number Mystery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
        font-family: Arial, sans-serif;
        background: #4caf50;
        text-align: center;
        padding: 5px;
        margin: 0;
        min-height: 100vh;
    }
    .container {
        background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
        padding: 20px 15px;
        border-radius: 20px;
        max-width: 420px;
        width: 95%;
        margin: 10px auto;
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        min-height: 85vh;
    }
    .parent-container {
        background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
        border: 3px solid #2196f3;
    }
    .game-container { min-height: 95vh; }
    .sticky-header {
        position: sticky;
        top: 0;
        background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
        z-index: 100;
        padding: 8px 0;
        border-radius: 15px;
        margin-bottom: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    h1 {
        color: #1b5e20;
        font-size: 3.5em;
        margin: 25px 0;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        line-height: 1.1;
        font-family: 'Comic Sans MS', 'Fredoka', 'Baloo', sans-serif;
    }
    .game-title, .main-directions {
        font-size: 1.6em;
        font-family: 'Comic Sans MS', 'Fredoka', 'Baloo', sans-serif;
        color: #1b5e20;
        margin: 10px 0;
        text-align: center;
    }
    .main-directions {
        padding: 15px;
        min-height: 60px;
        overflow-wrap: break-word;
    }
    .fox { font-size: 10em; margin: 30px 0; text-shadow: 4px 4px 8px rgba(0,0,0,0.2); }
    .fox-small { font-size: 1.8em; margin: 0; }
    .intro {
        font-size: 3em;
        color: #1b5e20;
        margin: 30px 0;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    button {
        background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
        color: white;
        border: none;
        padding: 20px 30px;
        font-size: 1.6em;
        border-radius: 30px;
        cursor: pointer;
        margin: 15px 8px;
        font-weight: bold;
        box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        touch-action: manipulation;
    }
    .continue-btn {
        background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        font-size: 1.4em;
        padding: 18px 25px;
    }
    .parent-btn {
        background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
        font-size: 1.2em;
        padding: 15px 20px;
    }
    .level-btn {
        background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
        font-size: 1.1em;
        padding: 12px 15px;
        margin: 8px;
    }
    .num-btn {
        background: linear-gradient(135deg, #607d8b 0%, #455a64 100%);
        color: white;
        border: none;
        padding: 15px;
        font-size: 1.4em;
        border-radius: 8px;
        cursor: pointer;
        margin: 3px;
        font-weight: bold;
        min-width: 50px;
        touch-action: manipulation;
    }
    input {
        padding: 18px;
        font-size: 1.4em;
        border: 4px solid #4caf50;
        border-radius: 12px;
        width: 250px;
        max-width: 85%;
        text-align: center;
        margin: 20px auto;
        background: white;
        font-weight: bold;
        display: block;
    }
    .answer-input {
        width: 200px;
        font-size: 1.3em;
        color: #1b5e20;
        display: block;
        margin: 15px auto;
        padding: 15px;
        cursor: pointer;
        user-select: none;
    }
    .number-pad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        max-width: 200px;
        margin: 15px auto;
    }
    .section {
        margin: 20px 0;
        padding: 25px;
        background: rgba(255,255,255,0.7);
        border-radius: 15px;
        border: 4px solid #4caf50;
    }
    .parent-section {
        border-color: #2196f3;
        margin: 15px 0;
        padding: 15px;
    }
    .directions {
        font-size: 1.4em;
        color: #1b5e20;
        margin: 20px 0;
        font-weight: bold;
    }
    .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 12px 0;
        padding: 10px;
        background: rgba(255,255,255,0.8);
        border-radius: 8px;
        font-size: 1em;
    }
    .setting-label {
        color: #37474f;
        font-weight: bold;
        text-align: left;
        flex: 1;
    }
    .checkbox { transform: scale(1.2); margin: 0 12px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<!-- Welcome Screen -->
<div id="welcome">
  <div class="container">
    <h1>🎯 Detective Number Mystery</h1>
    <div class="fox">🦊🔍</div>
    <div class="intro">Hi! I'm Memo the Fox!</div>
    <button onclick="startIntro()">🔊 Meet Memo!</button>
  </div>
</div>

<!-- Name Entry Screen -->
<div id="name-screen" class="hidden">
  <div class="container">
    <h1>🎯 Detective Number Mystery</h1>
    <div class="fox">🦊🔍</div>
    <div class="section">
      <div class="directions">What's your name, junior detective?</div>
      <input id="nameField" placeholder="Enter your name" maxlength="15">
      <button class="continue-btn" onclick="processName()">Next</button>
    </div>
  </div>
</div>

<!-- Greeting Screen -->
<div id="greeting-screen" class="hidden">
  <div class="container">
    <h1>🎯 Detective Number Mystery</h1>
    <div class="fox">🦊🔍</div>
    <div class="section">
      <div class="directions" id="greeting-text"></div>
      <button class="continue-btn" onclick="showParentSettings()">Continue</button>
    </div>
  </div>
</div>

<!-- Parent Settings Screen -->
<div id="parent-screen" class="hidden">
  <div class="container parent-container">
    <h1 style="color: #1565c0;">🎮 Parent Settings</h1>
    <div class="fox">👨‍👩‍👧‍👦</div>
    <div class="parent-section">
      <h3 style="color: #1565c0; font-size: 1.3em; margin: 10px 0;">🎯 Starting Level</h3>
      <select id="level-select">
        <option value="1">Level 1 (Numbers 1-4)</option>
        <option value="2">Level 2 (Numbers 1-5)</option>
        <option value="3">Level 3 (Numbers 1-6)</option>
        <option value="4">Level 4 (Numbers 1-7)</option>
        <option value="5">Level 5 (Numbers 1-8)</option>
      </select>
    </div>
    <div class="parent-section">
      <h3 style="color: #1565c0; font-size: 1.3em; margin: 10px 0;">🔊 Audio</h3>
      <div class="setting-row">
        <div class="setting-label">Voice narration:</div>
        <input type="checkbox" class="checkbox" id="voice-enabled" checked>
      </div>
      <div class="setting-row">
        <div class="setting-label">Say numbers:</div>
        <input type="checkbox" class="checkbox" id="speak-numbers" checked>
      </div>
    </div>
    <button class="parent-btn" onclick="startGame()">Start Game</button>
    <button class="parent-btn" onclick="showScreen('greeting-screen')">Back</button>
  </div>
</div>

  <!-- Game Screen -->
<div id="game-screen" class="hidden">
  <div class="container game-container">
    <div class="sticky-header game-header">
      <div class="game-title" id="game-title">🎯 Level 1: Numbers 1-4</div>
      <div class="header-right">
        <div class="streak-info" id="streak-display">STREAK: 0 | MISSION: Get 5 in a row!</div>
        <div class="longest-streak">Longest: <span id="longest-streak">0</span></div>
      </div>
    </div>

    <div class="main-directions" id="main-directions">Numbers 1 through 4 below, some are missing:</div>

    <div class="number-grid" id="number-grid"></div>

    <div class="timer-display" id="timer-display" style="display:none;"></div>

    <div class="section" id="input-section" style="display:none;">
      <div class="directions" id="input-prompt">Enter the missing numbers:</div>
      <input id="answer-input" class="answer-input" readonly onclick="preventKeyboard(event)">
      <div class="number-pad">
        <button class="num-btn" onclick="addToAnswer('1')">1</button>
        <button class="num-btn" onclick="addToAnswer('2')">2</button>
        <button class="num-btn" onclick="addToAnswer('3')">3</button>
        <button class="num-btn" onclick="addToAnswer('4')">4</button>
        <button class="num-btn" onclick="addToAnswer('5')">5</button>
        <button class="num-btn" onclick="addToAnswer('6')">6</button>
        <button class="num-btn" onclick="addToAnswer('7')">7</button>
        <button class="num-btn" onclick="addToAnswer('8')">8</button>
        <button class="num-btn" onclick="addSpace()">␣</button>
        <button class="num-btn" onclick="deleteLastChar()">⌫</button>
        <button class="num-btn" onclick="clearAnswer()">✖</button>
        <button class="num-btn" onclick="checkAnswer()">✅</button>
      </div>
    </div>

    <div class="feedback" id="feedback"></div>

    <button id="try-again-btn" class="continue-btn hidden" onclick="enableInput()">Try Again</button>
    <button id="show-numbers-btn" class="continue-btn hidden" onclick="showNumbersAgain()">Show Numbers Again</button>
    <button id="next-round-btn" class="continue-btn hidden" onclick="nextRound()">Next Round</button>

    <div id="level-options" class="level-options hidden">
      <button class="level-btn" onclick="stayLevel()">Same Level</button>
      <button class="level-btn" onclick="nextLevel()">Next Level</button>
      <button class="level-btn" onclick="showProgress()">Progress Chart</button>
      <button class="level-btn" onclick="finalEnd()">Quit Game</button>
    </div>

    <div id="progress-chart" class="hidden">
      <div class="badge-display">
        <div class="badge-icons" id="badge-icons">🏆</div>
        <div id="badge-count">0 badges</div>
      </div>
      <table class="progress-table">
        <thead>
          <tr><th>Level</th><th>Right</th><th>Attempts</th><th>Accuracy</th></tr>
        </thead>
        <tbody id="progress-content"></tbody>
        <tfoot>
          <tr class="totals-row">
            <td>Total</td>
            <td id="total-right">0</td>
            <td id="total-attempts">0</td>
            <td id="total-percent">0%</td>
          </tr>
        </tfoot>
      </table>
      <button id="resume-btn" class="continue-btn hidden" onclick="resumeGame()">Resume Game</button>
      <button id="quit-btn" class="continue-btn hidden" onclick="endGame()">Quit Game</button>
    </div>
  </div>
</div>

  <!-- Game Screen -->
<div id="game-screen" class="hidden">
  <div class="container game-container">
    <div class="sticky-header game-header">
      <div class="game-title" id="game-title">🎯 Level 1: Numbers 1-4</div>
      <div class="header-right">
        <div class="streak-info" id="streak-display">STREAK: 0 | MISSION: Get 5 in a row!</div>
        <div class="longest-streak">Longest: <span id="longest-streak">0</span></div>
      </div>
    </div>

    <div class="main-directions" id="main-directions">Numbers 1 through 4 below, some are missing:</div>

    <div class="number-grid" id="number-grid"></div>

    <div class="timer-display" id="timer-display" style="display:none;"></div>

    <div class="section" id="input-section" style="display:none;">
      <div class="directions" id="input-prompt">Enter the missing numbers:</div>
      <input id="answer-input" class="answer-input" readonly onclick="preventKeyboard(event)">
      <div class="number-pad">
        <button class="num-btn" onclick="addToAnswer('1')">1</button>
        <button class="num-btn" onclick="addToAnswer('2')">2</button>
        <button class="num-btn" onclick="addToAnswer('3')">3</button>
        <button class="num-btn" onclick="addToAnswer('4')">4</button>
        <button class="num-btn" onclick="addToAnswer('5')">5</button>
        <button class="num-btn" onclick="addToAnswer('6')">6</button>
        <button class="num-btn" onclick="addToAnswer('7')">7</button>
        <button class="num-btn" onclick="addToAnswer('8')">8</button>
        <button class="num-btn" onclick="addSpace()">␣</button>
        <button class="num-btn" onclick="deleteLastChar()">⌫</button>
        <button class="num-btn" onclick="clearAnswer()">✖</button>
        <button class="num-btn" onclick="checkAnswer()">✅</button>
      </div>
    </div>

    <div class="feedback" id="feedback"></div>

    <button id="try-again-btn" class="continue-btn hidden" onclick="enableInput()">Try Again</button>
    <button id="show-numbers-btn" class="continue-btn hidden" onclick="showNumbersAgain()">Show Numbers Again</button>
    <button id="next-round-btn" class="continue-btn hidden" onclick="nextRound()">Next Round</button>

    <div id="level-options" class="level-options hidden">
      <button class="level-btn" onclick="stayLevel()">Same Level</button>
      <button class="level-btn" onclick="nextLevel()">Next Level</button>
      <button class="level-btn" onclick="showProgress()">Progress Chart</button>
      <button class="level-btn" onclick="finalEnd()">Quit Game</button>
    </div>

    <div id="progress-chart" class="hidden">
      <div class="badge-display">
        <div class="badge-icons" id="badge-icons">🏆</div>
        <div id="badge-count">0 badges</div>
      </div>
      <table class="progress-table">
        <thead>
          <tr><th>Level</th><th>Right</th><th>Attempts</th><th>Accuracy</th></tr>
        </thead>
        <tbody id="progress-content"></tbody>
        <tfoot>
          <tr class="totals-row">
            <td>Total</td>
            <td id="total-right">0</td>
            <td id="total-attempts">0</td>
            <td id="total-percent">0%</td>
          </tr>
        </tfoot>
      </table>
      <button id="resume-btn" class="continue-btn hidden" onclick="resumeGame()">Resume Game</button>
      <button id="quit-btn" class="continue-btn hidden" onclick="endGame()">Quit Game</button>
    </div>
  </div>
</div>

      .display = 'block';
    disableInput();
  }
}

// Celebration
function showMegaCelebration() {
  const celebration = document.createElement('div');
  celebration.className = 'mega-celebration';
  celebration.innerHTML =
    '<div class="badge-emoji">🏆</div>' +
    '<div class="mega-celebration-text">DETECTIVE BADGE EARNED!</div>' +
    `<div class="mega-celebration-text">${playerName} got 5 in a row!</div>`;
  document.body.appendChild(celebration);

  speak(`Amazing work, ${playerName}! You earned a detective badge!`);

  setTimeout(() => {
    document.body.removeChild(celebration);
  }, 4000);
}

// Review
function showNumbersAgain() {
  const grid = document.getElementById('number-grid');
  grid.classList.remove('hidden-numbers');
  document.getElementById('try-again-btn').style.display = 'none';
  numbersVisible = true;
  disableInput();

  if (gameTimer) clearInterval(gameTimer);

  speak('Here are the numbers again. Study them carefully!', () => {
    const duration = levelDurations[currentLevel] || 7;
    startTimer(duration);
  });
}

// Level navigation
function nextRound() {
  createNewRound();
}

function stayLevel() {
  consecutiveCorrect = 0;
  document.getElementById('level-options').style.display = 'none';
  createNewRound();
}

function nextLevel() {
  if (currentLevel < 5) {
    currentLevel++;
    const config = levelConfig[currentLevel];
    document.getElementById('game-title').textContent = `🎯 Level ${currentLevel}: ${config.description}`;
    document.getElementById('main-directions').textContent = `Numbers 1 through ${config.numbers.length} below, some are missing:`;
    speak(`Moving to level ${currentLevel}!`);
  }
  consecutiveCorrect = 0;
  document.getElementById('level-options').style.display = 'none';
  setTimeout(createNewRound, 2000);
}

// Progress
function showProgress() {
  document.getElementById('level-options').style.display = 'none';

  let badgeIcons = '';
  for (let i = 0; i < badges; i++) badgeIcons += '🏆';
  document.getElementById('badge-icons').textContent = badgeIcons;
  document.getElementById('badge-count').textContent = `${badges} badge${badges !== 1 ? 's' : ''}`;

  const tbody = document.getElementById('progress-content');
  tbody.innerHTML = '';

  let totalRight = 0, totalAttempts = 0;

  for (let level = 1; level <= 5; level++) {
    const levelStats = stats[level];
    totalRight += levelStats.right;
    totalAttempts += levelStats.total;

    const pct = levelStats.total > 0 ? Math.round((levelStats.right / levelStats.total) * 100) : 0;

    const row = document.createElement('tr');
    row.innerHTML = `<td>Level ${level}</td><td>${levelStats.right}</td><td>${levelStats.total}</td><td>${pct}%</td>`;
    tbody.appendChild(row);
  }

  const totalPct = totalAttempts > 0 ? Math.round((totalRight / totalAttempts) * 100) : 0;
  document.getElementById('total-right').textContent = totalRight;
  document.getElementById('total-attempts').textContent = totalAttempts;
  document.getElementById('total-percent').textContent = `${totalPct}%`;

  document.getElementById('progress-chart').style.display = 'block';
  document.getElementById('resume-btn').style.display = 'block';
  document.getElementById('quit-btn').style.display = 'block';
}

function resumeGame() {
  consecutiveCorrect = 0;
  document.getElementById('progress-chart').style.display = 'none';
  document.getElementById('resume-btn').style.display = 'none';
  document.getElementById('quit-btn').style.display = 'none';
  createNewRound();
}

function endGame() {
  gameEnded = true;
  speak('Game ended. Thanks for playing!');
  showScreen('welcome');
}

function finalEnd() {
  gameEnded = true;
  speak('Thank you for playing the Detective Number Mystery Game! Goodbye!');
  showScreen('welcome');
}
</script>
</body>
</html>
  
